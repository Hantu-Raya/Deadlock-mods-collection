(function(){'use strict';const hb=$('#unit_healthbar_lagging');if(!hb)return;const C={HIGH1:[255,201,97],HIGH2:[100,133,252],MID:[255,123,0],LOW:[225,97,97],NEU:'rgb(91,239,181)',DARK_LOW:[85,28,28]};const ldr=[155,63,63];const LDC=new Array(101),LMC=new Array(41),MHC1=new Array(36),MHC2=new Array(36);function lerp(a,b,t){return a+(b-a)*t;}function toRGB(r,g,b){return'rgb('+(r|0)+','+(g|0)+','+(b|0)+')';}function interpRGB(c1,c2,t){return toRGB(lerp(c1[0],c2[0],t),lerp(c1[1],c2[1],t),lerp(c1[2],c2[2],t));}let i=0;while(i<=100){LDC[i]=interpRGB(C.LOW,C.DARK_LOW,i/100);++i;}i=0;while(i<=40){LMC[i]=interpRGB(C.LOW,C.MID,i/40);++i;}i=0;while(i<=35){const t=i/35;MHC1[i]=interpRGB(C.MID,C.HIGH1,t);MHC2[i]=interpRGB(C.MID,C.HIGH2,t);++i;}const UDC=new Array(101);i=0;while(i<=100){UDC[i]=interpRGB(C.LOW,ldr,i/100);++i;}let pp=0;const PS=10,PI=0.03,CTT=500;let cp=null,ct=null,ce=null,cn=null,lw=-1,lpw=-1,lhp=-1,lc=null,lct=0,lcp=-1,sc=0,bm=0.1,scanObj={team:null,enemy:false,neutral:false};function scanAnc(root){scanObj.team=null;scanObj.enemy=false;scanObj.neutral=false;let p=root;while(p){if(typeof p.BHasClass==='function'){if(!scanObj.team){if(p.BHasClass('team2'))scanObj.team='team2';else if(p.BHasClass('team1'))scanObj.team='team1';}if(!scanObj.enemy&&p.BHasClass('enemy'))scanObj.enemy=true;if(!scanObj.neutral&&(p.BHasClass('team_neutral')||p.BHasClass('neutral')))scanObj.neutral=true;if(scanObj.team&&scanObj.enemy&&scanObj.neutral)break;}if(typeof p.GetParent!=='function')break;p=p.GetParent();}return scanObj;}function ensureCache(){const now=Date.now();if(ce===null||cn===null||(now-lct)>CTT){lct=now;const res=scanAnc(hb);ct=res.team;ce=res.enemy;cn=res.neutral;}const curp=typeof hb.GetParent==='function'?hb.GetParent():null;if(cp!==curp)cp=curp;}function update(){ensureCache();const ui=$('#unit_ult_ready_icon');if(cn){if(lc!==C.NEU){hb.style.washColor=C.NEU;lc=C.NEU;}return $.Schedule(0.5,update);}if(!ce)return $.Schedule(0.2,update);const curp=typeof hb.GetParent==='function'?hb.GetParent():null;if(cp!==curp){cp=curp;lpw=-1;lw=-1;}const w=hb.actuallayoutwidth|0,pw=cp&&cp.actuallayoutwidth!==undefined?cp.actuallayoutwidth|0:0;if(pw<=0)return $.Schedule(0.18,update);if(w===lw&&pw===lpw)return $.Schedule((lhp<=25?PI:bm),update);lw=w;lpw=pw;const pct=Math.min(100,Math.max(0,(w/pw)*100));lhp=pct;const pctChanged=Math.abs(pct-lcp)>=5;if(pctChanged){sc=0;bm=0.1;lcp=pct;}else{sc++;bm=Math.min(1,bm*2);}let color=null,ni=bm;if(pct<=25){pp=(pp+PS)%PL;const pi=PT[pp];color=LDC[pi];if(ui)ui.style.washColor=UDC[pi];ni=PI;}else if(pct<=65){if(!pctChanged)return $.Schedule(ni,update);let idx=Math.round(((pct-25)/40)*40)|0;if(idx<0)idx=0;else if(idx>40)idx=40;color=LMC[idx];}else{if(!pctChanged)return $.Schedule(ni,update);ensureCache();let idx2=Math.round(((pct-65)/35)*35)|0;if(idx2<0)idx2=0;else if(idx2>35)idx2=35;color=ct==='team2'?MHC2[idx2]:MHC1[idx2];}if(color!==lc){hb.style.washColor=color;lc=color;}if(ui)ui.style.washColor=color;return $.Schedule(ni,update);}update();})();